<!-- frontend/index.html -->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Карта рибалки</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>#map { height: 100vh; }</style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([50.45, 30.52], 6);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    fetch('http://localhost:8000/reports')
      .then(res => res.json())
      .then(reports => {
        reports.forEach(([id, lat, lon, desc, img, likes]) => {
          const marker = L.marker([lat, lon]).addTo(map);
          marker.bindPopup(`
            <img src="http://localhost:8000/image/${img}" width="200"/><br/>
            <b>${desc}</b><br/>
            ❤️ ${likes} <button onclick="like('${id}')">Лайк</button><br/>
            <textarea id="c${id}"></textarea>
            <button onclick="comment('${id}')">Комент</button><br/>
            <div id="comments${id}"></div>
          `);
        });
      });

    function like(id) {
      fetch(`http://localhost:8000/like/${id}`, {method: "POST"})
        .then(() => alert("Лайк!"));
    }

    function comment(id) {
      const text = document.getElementById("c" + id).value;
      const formData = new FormData();
      formData.append("text", text);
      fetch(`http://localhost:8000/comment/${id}`, {
        method: "POST",
        body: formData
      }).then(() => alert("Коментар додано!"));
    }
  </script>
</body>
</html>
